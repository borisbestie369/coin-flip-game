<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'Helvetica Neue'; color: #dcdcdc; -webkit-text-stroke: #dcdcdc; background-color: #171818}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'Helvetica Neue'; color: #dcdcdc; -webkit-text-stroke: #dcdcdc; background-color: #171818; min-height: 18.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="theme-color" content="#0f172a"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Coin Flip P2P&lt;/title&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>:root {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--bg-color: #0f172a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--text-color: #f1f5f9;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--coin-gold: #eab308;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--btn-primary: #eab308;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--btn-disabled: #475569;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>--panel-bg: #1e293b;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>:root { color-scheme: dark; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: var(--bg-color);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: var(--text-color);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flex-direction: column;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-height: 100dvh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>user-select: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>touch-action: manipulation;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.bg-blob {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; opacity: 0.15;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: radial-gradient(circle at 20% 20%, #9333ea 0%, transparent 40%),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>radial-gradient(circle at 80% 80%, #2563eb 0%, transparent 40%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.app-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%; max-width: 400px; display: flex; flex-direction: column;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: center; gap: 1.5rem; padding: 1rem; z-index: 10;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.header h1 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 2rem; font-weight: 900; color: #fde047;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>text-transform: uppercase; letter-spacing: 1px; text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.perspective-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>perspective: 1000px; width: 200px; height: 200px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: relative; margin: 1rem 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.coin {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%; height: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: relative; transform-style: preserve-3d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transition: transform 3000ms cubic-bezier(0.25, 1, 0.5, 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.face {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: absolute; width: 100%; height: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>backface-visibility: hidden; -webkit-backface-visibility: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 50%; display: flex; align-items: center; justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 4px solid; background-color: #1e293b;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.face-heads { border-color: #ca8a04; background: linear-gradient(135deg, #fde047, #eab308); transform: rotateY(0deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.face-tails { border-color: #64748b; background: linear-gradient(135deg, #cbd5e1, #94a3b8); transform: rotateY(180deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.face-text { font-size: 5rem; font-weight: bold; font-family: serif; color: rgba(255,255,255,0.9); }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.status-badge {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: rgba(0,0,0,0.3); padding: 0.5rem 1rem; border-radius: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.status-dot { width: 8px; height: 8px; border-radius: 50%; background: #ef4444; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.status-dot.online { background: #22c55e; box-shadow: 0 0 10px #22c55e; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.status-dot.connecting { background: #fde047; animation: blink 1s infinite; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>@keyframes blink { 50% { opacity: 0.5; } }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.controls { width: 100%; display: flex; flex-direction: column; gap: 1rem; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: none; outline: none; cursor: pointer; font-family: inherit;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex; align-items: center; justify-content: center; gap: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-weight: 700; border-radius: 12px; transition: all 0.2s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button:active { transform: scale(0.98); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-main {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: var(--btn-primary); color: #0f172a; padding: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 1.1rem; width: 100%; box-shadow: 0 4px 0 #a16207;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-main:disabled {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: var(--btn-disabled); color: #94a3b8;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: none; cursor: not-allowed; transform: translateY(4px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-retry {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #334155; color: white; padding: 0.8rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.9rem; margin-top: 0.5rem; display: none; /* Hidden by default */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.share-box {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex; gap: 8px; background: rgba(0,0,0,0.3); padding: 4px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.share-input {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: transparent; border: none; color: #94a3b8; font-family: monospace;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.8rem; width: 100%; padding: 0 8px; outline: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-copy-small {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #334155; color: white; padding: 8px 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 8px; font-size: 0.8rem; white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.stats {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%; background: var(--panel-bg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.stats-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.history { display: flex; justify-content: center; gap: 8px; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); min-height: 40px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.bubble { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.bubble-h { background: #eab308; color: #422006; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.bubble-t { background: #94a3b8; color: #0f172a; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#toast {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #334155; color: white; padding: 10px 20px; border-radius: 30px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.9rem; opacity: 0; pointer-events: none; transition: opacity 0.3s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 100; white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#debugLog {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 10px; color: #475569; margin-top: 1rem; text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: monospace; max-width: 300px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="bg-blob"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="app-container"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="status-badge"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="statusDot" class="status-dot connecting"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span id="playerStatus"&gt;Initializing...&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="header"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h1&gt;Coin Flip&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="perspective-container"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="coin" class="coin"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="face face-heads"&gt;&lt;span class="face-text"&gt;H&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="face face-tails"&gt;&lt;span class="face-text"&gt;T&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="controls"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="flipBtn" class="btn-main" disabled&gt;WAITING...&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="retryBtn" class="btn-retry"&gt;Stuck? Click to Retry&lt;/button&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="share-box" id="shareSection"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input type="text" id="linkInput" class="share-input" readonly value="Creating room..."&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="copyLinkBtn" class="btn-copy-small"&gt;Copy&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="stats"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="stats-row"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span style="color: #facc15"&gt;HEADS: &lt;span id="headsCount"&gt;0&lt;/span&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span style="color: #cbd5e1"&gt;TAILS: &lt;span id="tailsCount"&gt;0&lt;/span&gt;&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="history" id="historyContainer"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span style="font-size: 12px; color: #64748b;"&gt;No history yet&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="debugLog"&gt;Logs will appear here...&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="toast"&gt;Link copied!&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Game State ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const state = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>angle: 0,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>counts: { heads: 0, tails: 0 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>history: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isFlipping: false</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let peer = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let conn = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let myId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let hostId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let isHost = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let handshakeInterval = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let connectionTimeout = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- DOM Elements ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const coin = document.getElementById('coin');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const flipBtn = document.getElementById('flipBtn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const retryBtn = document.getElementById('retryBtn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const headsCount = document.getElementById('headsCount');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const tailsCount = document.getElementById('tailsCount');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const historyContainer = document.getElementById('historyContainer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const linkInput = document.getElementById('linkInput');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const copyLinkBtn = document.getElementById('copyLinkBtn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const toast = document.getElementById('toast');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const statusDot = document.getElementById('statusDot');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const playerStatus = document.getElementById('playerStatus');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const shareSection = document.getElementById('shareSection');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const debugLog = document.getElementById('debugLog');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function log(msg) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.log(msg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>debugLog.innerText = msg;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function init() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const urlParams = new URLSearchParams(window.location.search);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Trim to avoid copy-paste errors</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hostId = urlParams.get('g') ? urlParams.get('g').trim() : null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (hostId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>isHost = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>initPeer();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>shareSection.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>playerStatus.innerText = "Connecting to Host...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("Guest Mode. Target: " + hostId.substring(0, 4) + "...");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>isHost = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>initPeer();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>playerStatus.innerText = "Creating Room...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("Host Mode. Initializing...");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function initPeer() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Use standard PeerJS config</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>peer = new Peer(null, { debug: 1 });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>peer.on('open', (id) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>myId = id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("My ID generated: " + id.substring(0, 4) + "...");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (isHost) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Waiting for friend...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>statusDot.className = 'status-dot';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const url = window.location.href.split('?')[0] + '?g=' + id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>linkInput.value = url;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>enableFlipBtn("FLIP COIN");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>connectToHost();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>peer.on('connection', (connection) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (conn) { conn.close(); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>conn = connection;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>setupConnection();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>peer.on('error', (err) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>console.error(err);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (err.type === 'peer-unavailable') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Host not found.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>log("Error: Host ID not found. Did they refresh?");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>retryBtn.style.display = "block";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>retryBtn.innerText = "Host Missing - Ask for New Link";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Connection Error";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>log("Error: " + err.type);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>retryBtn.style.display = "block";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>statusDot.className = 'status-dot';<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>peer.on('disconnected', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("Peer disconnected from server.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Auto reconnect to server</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>peer.reconnect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function connectToHost() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!hostId) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>log("Connecting...");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>retryBtn.style.display = "none"; // Hide retry while trying</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (conn) conn.close();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conn = peer.connect(hostId, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>reliable: true</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setupConnection();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Safety timeout: If not connected in 5s, show retry</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (connectionTimeout) clearTimeout(connectionTimeout);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>connectionTimeout = setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (!conn || !conn.open) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Taking too long...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>log("Timeout. Network issues?");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>retryBtn.style.display = "block";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 6000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function setupConnection() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conn.on('open', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("Connection Open! Starting handshake.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (connectionTimeout) clearTimeout(connectionTimeout);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>retryBtn.style.display = "none";</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (!isHost) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>// GUEST LOGIC: Aggressive Handshake</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if(handshakeInterval) clearInterval(handshakeInterval);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>// Send immediately</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>conn.send({ type: 'REQUEST_STATE' });</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>// And keep sending until response</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>handshakeInterval = setInterval(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if(conn &amp;&amp; conn.open) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>console.log("Pinging Host...");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>conn.send({ type: 'REQUEST_STATE' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}, 500);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conn.on('data', (data) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>handleData(data);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conn.on('close', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>playerStatus.innerText = "Disconnected";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>statusDot.className = 'status-dot';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>log("Connection closed.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(!isHost) retryBtn.style.display = "block";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function handleData(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Filter noise</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if(data.type !== 'STATE_UPDATE') console.log("RX:", data.type);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (data.type === 'STATE_UPDATE') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// SUCCESSFUL HANDSHAKE</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(!isHost &amp;&amp; handshakeInterval) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>clearInterval(handshakeInterval);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>handshakeInterval = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>log("Handshake Success! Synced.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Connected!";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>statusDot.className = 'status-dot online';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>enableFlipBtn("FLIP COIN");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(isHost) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>playerStatus.innerText = "Friend Connected!";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>statusDot.className = 'status-dot online';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Sync State</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.angle = data.payload.angle;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.counts = data.payload.counts;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.history = data.payload.history;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.isFlipping = data.payload.isFlipping;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>updateUI();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else if (data.type === 'FLIP_REQUEST') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (isHost &amp;&amp; !state.isFlipping) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>log("Guest requested flip.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>performFlip();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else if (data.type === 'REQUEST_STATE') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Host responds to handshake</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (isHost) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>// Send state back</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>sendState();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function sendState() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (conn &amp;&amp; conn.open) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>conn.send({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>type: 'STATE_UPDATE',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>payload: state</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function performFlip() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (state.isFlipping) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>state.isFlipping = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>disableFlipBtn();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const randomVal = Math.random();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const outcome = randomVal &gt; 0.5 ? 'tails' : 'heads';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const baseRotation = 1800 + (Math.floor(Math.random() * 3) * 360);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let nextAngle = state.angle + baseRotation;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const currentMod = nextAngle % 360;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (outcome === 'heads') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>nextAngle += (360 - currentMod);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>nextAngle += (180 - currentMod) + 360;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>state.angle = nextAngle;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>updateUI();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendState();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.isFlipping = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.counts[outcome]++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.history.unshift(outcome);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (state.history.length &gt; 5) state.history.pop();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>updateUI();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>sendState();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Both can flip again</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(isHost || (conn &amp;&amp; conn.open)) enableFlipBtn("FLIP COIN");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 3000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function updateUI() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>coin.style.transform = `rotateY(${state.angle}deg)`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>headsCount.innerText = state.counts.heads;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>tailsCount.innerText = state.counts.tails;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (state.history.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>historyContainer.innerHTML = '&lt;span style="font-size: 12px; color: #64748b;"&gt;No history yet&lt;/span&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>historyContainer.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>state.history.forEach(h =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const b = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>b.className = `bubble ${h === 'heads' ? 'bubble-h' : 'bubble-t'}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>b.innerText = h.charAt(0).toUpperCase();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>historyContainer.appendChild(b);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (state.isFlipping) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>disableFlipBtn();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if(conn &amp;&amp; conn.open) enableFlipBtn("FLIP COIN");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function disableFlipBtn() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flipBtn.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flipBtn.innerText = "FLIPPING...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function enableFlipBtn(text) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flipBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flipBtn.innerText = text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flipBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (state.isFlipping) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (isHost) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>performFlip();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (conn &amp;&amp; conn.open) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>conn.send({ type: 'FLIP_REQUEST' });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>disableFlipBtn();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>copyLinkBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>linkInput.select();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>linkInput.setSelectionRange(0, 99999);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (navigator.clipboard) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>navigator.clipboard.writeText(linkInput.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>document.execCommand("copy");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>toast.style.opacity = '1';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; toast.style.opacity = '0', 2000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>retryBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>connectToHost();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>init();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
